<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cadastro de {{ titulo }}</title>
  <link rel="stylesheet" href="{{url_for('static', filename='style.css')}}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-..." crossorigin="anonymous">
</head>
<body class="bg-light">

<div class="container py-4">
  <h3>{{ titulo }}</h3>
  <a href="{{ url_for('index') }}" class="btn btn-primary mt-2">&larr;Início</a>

  {% with messages = get_flashed_messages() %}
    {% if messages %}
      {% for m in messages %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
          {{ m }}
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

<section class="form-area mb-4 pt-3">
<h4>Novo anúncio</h4>
<form action="{{ url_for('anuncio_criar') }}" method="post" class="row g-3">
  <div class="col-md-6">
    <label class="form-label">Título</label>
    <input type="text" name="titulo" class="form-control" required>
  </div>

  <div class="col-md-12">
    <label class="form-label">Descrição</label>
    <textarea name="descricao" rows="3" class="form-control" required></textarea>
  </div>

  <div class="col-md-4">
    <label class="form-label">Preço</label>
    <input type="number" step="0.01" name="preco" class="form-control" required>
  </div>

  <div class="col-md-4">
    <label class="form-label">Categoria</label>
    <select name="id_categoria" class="form-select" required>
      {% for c in categorias %}<option value="{{ c.id_categoria }}">{{ c.nome }}</option>{% endfor %}
    </select>
  </div>

  <div class="col-md-4">
    <label class="form-label">Usuário (vendedor)</label>
    <select name="id_usuario" class="form-select" required>
      {% for u in usuarios %}<option value="{{ u.id_usuario }}">{{ u.nome }}</option>{% endfor %}
    </select>
  </div>

  <div class="col-12">
    <button type="submit" class="btn btn-primary mt-2">Cadastrar</button>
  </div>
</form>
</section>

{% if anuncio_editar %}
<section class="form-area warn mb-4">
  <h4>Editar anúncio #{{ anuncio_editar.id_anuncio }}</h4>
  <form action="{{ url_for('anuncio_editar', id_anuncio=anuncio_editar.id_anuncio) }}" method="post" class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Título</label>
      <input type="text" name="titulo" value="{{ anuncio_editar.titulo }}" class="form-control" required>
    </div>
    <div class="col-md-12">
      <label class="form-label">Descrição</label>
      <textarea name="descricao" rows="3" class="form-control" required>{{ anuncio_editar.descricao }}</textarea>
    </div>
    <div class="col-md-4">
      <label class="form-label">Preço</label>
      <input type="number" step="0.01" name="preco" value="{{ anuncio_editar.preco }}" class="form-control" required>
    </div>
    <div class="col-md-4">
      <label class="form-label">Categoria</label>
      <select name="id_categoria" class="form-select" required>
        {% for c in categorias %}
          <option value="{{ c.id_categoria }}" {% if c.id_categoria == anuncio_editar.id_categoria %}selected{% endif %}>{{ c.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Usuário (vendedor)</label>
      <select name="id_usuario" class="form-select" required>
        {% for u in usuarios %}
          <option value="{{ u.id_usuario }}" {% if u.id_usuario == anuncio_editar.id_usuario %}selected{% endif %}>{{ u.nome }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-12 mt-2">
      <button type="submit" class="btn btn-success">Salvar</button>
      <a class="btn btn-secondary" href="{{ url_for('anuncio_list') }}">Cancelar</a>
    </div>
  </form>
</section>
{% endif %}

<table class="table table-striped table-bordered">
  <thead class="table-dark">
    <tr>
      <th>ID</th><th>Título</th><th>Preço</th><th>Categoria</th><th>Vendedor</th><th>Publicado</th><th>Ações</th>
    </tr>
  </thead>
  <tbody>
  {% for a in anuncios %}
    <tr>
      <td>{{ a.id_anuncio }}</td>
      <td>{{ a.titulo }}</td>
      <td>R$ {{ '%.2f'|format(a.preco) }}</td>
      <td>{{ a.categoria.nome }}</td>
      <td>{{ a.usuario.nome }}</td>
      <td>{{ a.data_publicacao.strftime('%d/%m/%Y %H:%M') }}</td>
      <td>
        <a class="btn btn-sm btn-outline-primary" href="{{ url_for('anuncio_list', edit_id=a.id_anuncio) }}">Editar</a>
        <a class="btn btn-sm btn-outline-danger" href="{{ url_for('anuncio_list', confirm_delete_id=a.id_anuncio) }}">Excluir</a>
      </td>
    </tr>
  {% endfor %}
  </tbody>
</table>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-..." crossorigin="anonymous"></script>
</body>
</html>
